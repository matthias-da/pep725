% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pep_flag_outliers.R
\name{pep_flag_outliers}
\alias{pep_flag_outliers}
\title{Flag Phenological Outliers}
\usage{
pep_flag_outliers(
  pep,
  by = c("s_id", "genus", "species", "phase_id"),
  method = c("30day", "mad", "iqr", "zscore"),
  threshold = NULL,
  center = c("median", "mean"),
  min_obs = 5,
  flag_only = TRUE
)
}
\arguments{
\item{pep}{A \code{pep} object or data.table with phenological observations.
Must contain \code{year}, \code{day}, and grouping columns.}

\item{by}{Character vector of columns defining groups for outlier detection.
Default \code{c("s_id", "genus", "species", "phase_id")} detects outliers
within each station-species-phase combination.}

\item{method}{Character. Outlier detection method:
\describe{
\item{"30day"}{(Default) Flag observations >30 days from group mean/median.
The classic Schaber-Badeck approach for phenological data.}
\item{"mad"}{Use Median Absolute Deviation. Flag if |deviation| > k * MAD,
where k is set by \code{threshold}.}
\item{"iqr"}{Use Interquartile Range. Flag if outside (Q1 - k\emph{IQR, Q3 + k}IQR).}
\item{"zscore"}{Flag if |z-score| > threshold (default 3).}
}}

\item{threshold}{Numeric. Threshold for outlier detection.
\describe{
\item{For "30day":}{Days deviation to flag as outlier. Default 30.}
\item{For "mad":}{Number of MADs. Default 3 (~2.5 SD equivalent).}
\item{For "iqr":}{IQR multiplier. Default 1.5 (standard Tukey rule).}
\item{For "zscore":}{Z-score threshold. Default 3.}
}}

\item{center}{Character. Central tendency measure: \code{"median"} (default,
more robust) or \code{"mean"}.}

\item{min_obs}{Integer. Minimum observations per group required for outlier
detection. Groups with fewer observations are skipped. Default 5.}

\item{flag_only}{Logical. If \code{TRUE} (default), adds outlier flag columns
to data. If \code{FALSE}, removes flagged outliers from data.}
}
\value{
If \code{flag_only = TRUE}: The input data with additional columns:
\describe{
\item{is_outlier}{Logical. TRUE for flagged outliers.}
\item{deviation}{Numeric. Days deviation from expected value.}
\item{expected_doy}{Numeric. Expected DOY for the group.}
}
If \code{flag_only = FALSE}: Data with outliers removed.
}
\description{
Identifies outlier observations in phenological data using the 30-day rule
or statistical methods. Based on the approach described by Schaber & Badeck
(2002) for quality control of phenological observations.
}
\details{
The 30-day rule (Schaber & Badeck 2002) is widely used for phenological data
quality control. It flags observations that deviate more than 30 days from
the expected value for that station-species-phase combination. This threshold
is based on the observation that legitimate phenological variation rarely
exceeds one month.
}
\section{When to Use Each Method}{

\describe{
\item{30day}{Standard for phenological QC. Use when the 30-day biological
threshold is meaningful.}
\item{mad}{Robust to existing outliers. Good for initial screening of
potentially contaminated data.}
\item{iqr}{Standard statistical approach. Useful when comparing with
other quality metrics.}
\item{zscore}{Parametric approach. Use when data is approximately normal.}
}
}

\examples{
\donttest{
data(pep_seed)

# Flag outliers using 30-day rule
pep_flagged <- pep_flag_outliers(pep_seed)
table(pep_flagged$is_outlier)

# View flagged observations
pep_flagged[is_outlier == TRUE]

# Remove outliers instead of flagging
pep_clean <- pep_flag_outliers(pep_seed, flag_only = FALSE)

# Use MAD method with stricter threshold
pep_flagged <- pep_flag_outliers(pep_seed, method = "mad", threshold = 2.5)

# Group by country instead of station
pep_flagged <- pep_flag_outliers(pep_seed,
                              by = c("country", "genus", "phase_id"))
}

}
\references{
Schaber J, Badeck F-W (2002). Evaluation of methods for the combination of
phenological time series and outlier detection. Tree Physiology 22:973-982.
}
\seealso{
\code{\link{pep_quality}} for comprehensive quality assessment,
\code{\link{pheno_combine}} which uses residuals for outlier detection
}
\author{
Matthias Templ
}
