% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/regional_box_ts_heading_harvest.R
\name{regional_box_ts_heading_harvest}
\alias{regional_box_ts_heading_harvest}
\title{Compile Regional Phenological and Climate Time Series}
\usage{
regional_box_ts_heading_harvest(
  pep = get("pep", envir = parent.frame()),
  giss = get("giss", envir = parent.frame()),
  agroscope = get("agroscope", envir = parent.frame()),
  meteoSwiss = get("meteoSwiss", envir = parent.frame()),
  lon_min = 4.2,
  lon_max = 8.1,
  lat_min = 44.7,
  lat_max = 48.1,
  plz_target = 1260,
  species_name = "Triticum aestivum",
  year_min = 1961,
  pep_for_giss = c("aggregated", "near")
)
}
\arguments{
\item{lon_min}{Minimum longitude for bounding box filter (default is 4.2)}

\item{lon_max}{Maximum longitude for bounding box filter (default is 8.1)}

\item{lat_min}{Minimum latitude for bounding box filter (default is 44.7)}

\item{lat_max}{Maximum latitude for bounding box filter (default is 48.1)}

\item{plz_target}{Postal code used to filter Agroscope trials (default is 1260 = Changins)}

\item{species_name}{Name of the species to filter (default is \code{"Triticum aestivum"})}

\item{year_min}{Minimum year for all time series outputs (default is 1961)}

\item{pep_for_giss}{Which PEP725 dataset to use for merging with GISS climate anomalies. Either \code{"aggregated"} (global) or \code{"near"} (spatially filtered near Changins)}
}
\value{
A named list with the following elements:
\describe{
\item{\code{ts_tidy}}{Long-format time series combining PEP725, Agroscope, and MeteoSwiss data, with consistent phase and source labeling}
\item{\code{pep_agg}}{Aggregated PEP725 time series (global species-level)}
\item{\code{pep_cgi}}{Spatially filtered PEP725 time series (based on lat/lon box)}
\item{\code{giss}}{GISS global temperature anomalies for matching years}
\item{\code{pep_giss}}{PEP time series (aggregated or filtered) merged with GISS anomalies}
}
}
\description{
Generates a collection of harmonized phenological time series for a specified species and spatial region, using data from multiple sources: PEP725 (aggregated and filtered), Agroscope field trials, MeteoSwiss observations, and GISS global temperature anomalies. This function supports comparative analysis across data sources and climate-sensitivity studies.
}
\details{
This function filters the PEP725 dataset by species and optionally by spatial box. It aggregates phenological phases (Heading = 60, Harvest = 100) and computes mean day-of-year (DOY) per year. Agroscope and MeteoSwiss observations are transformed to tidy format and included for regional comparison. GISS temperature anomalies are merged with the selected PEP time series to support phenologyâ€“climate analysis. Warnings are issued if phases are missing for selected periods.
}
\examples{
out <- regional_box_ts_heading_harvest(species_name = "Triticum aestivum")
str(out$ts_tidy)
gt <- pheno_plot_hh(out, type = "timeseries")
gt
pheno_plot_hh(out, type = "giss_smooth", smooth = "loess", se = TRUE)
gc <- pheno_plot_hh(out, type = "giss_sensitivity")
pcs <- pheno_plot_hh(out, type = "giss_smooth") # TODO: wrong
gc
gt | gc
pcs | gc

# Example for other (selected) coordinates of the PEP data:
out <- regional_box_ts_heading_harvest(pep_for_giss = "near",
                        lon_min = 4.2,  lon_max = 8.1, # default near Changins
                        lat_min = 44.7, lat_max = 48.1, # default near Changins
)
str(out$ts_tidy)
gt <- pheno_plot_hh(out, type = "timeseries")
gt
pheno_plot_hh(out, type = "giss_smooth", smooth = "loess", se = TRUE)
gc <- pheno_plot_hh(out, type = "giss_sensitivity")
pcs <- pheno_plot_hh(out, type = "giss_smooth") # TODO: wrong
gc
gt | gc
pcs | gc

# Example for other year selection
out <- regional_box_ts_heading_harvest(species_name = "Triticum aestivum", year_min = 1980)
str(out$ts_tidy)
gt <- pheno_plot_hh(out, type = "timeseries")
gt
pheno_plot_hh(out, type = "giss_smooth", smooth = "loess", se = TRUE)
gc <- pheno_plot_hh(out, type = "giss_sensitivity")
pcs <- pheno_plot_hh(out, type = "giss_smooth") # TODO: wrong
gc
gt | gc
pcs | gc
# Example to select only nearby stations (more useful that using all PEP station data)

# Better to select only stations near Changins and for the last 40 years:
d <- regional_box_ts_heading_harvest(pep_for_giss = "near",
                        lon_min = 4.2,  lon_max = 8.1, # default near Changins
                        lat_min = 44.7, lat_max = 48.1, # default near Changins
                        year_min = 1980 # <- only for the last 40 years
)
# becomes linear!
str(out$ts_tidy)
gt <- pheno_plot_hh(out, type = "timeseries")
gt
pheno_plot_hh(out, type = "giss_smooth", smooth = "loess", se = TRUE)
gc <- pheno_plot_hh(out, type = "giss_sensitivity")
pcs <- pheno_plot_hh(out, type = "giss_smooth") # TODO: wrong
pcs | gc
pheno_plot_hh(d, type = "timeseries", alpha_lines = 0.6, linewidth = 0.7)
}
\seealso{
\code{\link{pep_import}}, \code{\link{agroscope}}, \code{\link{meteoSwiss}}, \code{\link{giss}}
}
\author{
Matthias Templ
}
