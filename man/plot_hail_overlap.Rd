% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_hail_overlap.R
\name{plot_hail_overlap}
\alias{plot_hail_overlap}
\title{Plot Hail-Phenology Overlap for One or Multiple Countries and Scenarios}
\usage{
plot_hail_overlap(
  hail,
  pep,
  giss,
  Country,
  regions = NULL,
  phase1 = 65,
  phase2 = 87,
  genus_name = "Malus",
  phenology_method = c("robust_shift", "simple_shift", "gdd_cmip6"),
  scen = c("ctrl", "scen", "both"),
  facet_countries = FALSE,
  overlay_both = FALSE,
  show_integral = TRUE,
  integral_cex = 3,
  scen_warming = 3,
  shift_per_deg = -4,
  cmip6_tas = NULL,
  gdd_base = 5,
  gdd_threshold1 = 150,
  gdd_threshold2 = 350,
  color_ctrl = "dodgerblue3",
  color_scen = "tomato3",
  title = NULL
)
}
\arguments{
\item{hail}{A hail dataset with columns \code{Country}, \code{Scenario},
\code{DOY}, and \code{mean}. Must include both CTRL and SCEN where
applicable.}

\item{pep}{A PEP phenology dataset from which phenological DOYs are estimated.}

\item{giss}{Data frame with GISS temperature data. Required for robust_shift method.}

\item{Country}{Character. Country to plot when \code{facet_countries = FALSE}.}

\item{regions}{Character vector. Countries/regions to include. If NULL, all are used.
Ignored when \code{facet_countries = TRUE}.}

\item{phase1, phase2}{Integer. BBCH phenophases defining the phenology window.}

\item{genus_name}{Character. Genus to filter from \code{pep}
(default \code{"Malus"}).}

\item{phenology_method}{Character. One of:
\itemize{
\item \code{"simple_shift"}: shifts phenology linearly by warming.
\item \code{"gdd_cmip6"}: computes GDD-based phenology from CMIP6 temperatures.
}}

\item{scen}{One of \code{"ctrl"}, \code{"scen"}, or \code{"both"},
controlling which scenario(s) to visualize.}

\item{facet_countries}{Logical. If \code{FALSE}, only one country is plotted.
If \code{TRUE}, panels for multiple countries are created.
The behavior depends on \code{scen}:
\itemize{
\item \code{scen="ctrl"} or \code{"scen"}:
facet panels for each country.
\item \code{scen="both"}:
either a Country × Scenario facet grid (default), or
an overlay view per country if \code{overlay_both = TRUE}.
}}

\item{overlay_both}{Logical (default \code{FALSE}).
When \code{facet_countries = TRUE} and \code{scen = "both"}, enables
a new overlay mode:
\itemize{
\item One facet per country.
\item CTRL and SCEN hail curves overlaid.
\item Phenology windows for both scenarios drawn as semi-transparent bands.
}
This mode resembles a multi-country comparison of full CTRL-SCEN
climatologies without splitting the panels by scenario.}

\item{show_integral}{Logical. If \code{TRUE}, the integrated hail exposure
(computed by \code{integral_hail()}) is displayed in each panel.}

\item{integral_cex}{Numeric. Text size for integral labels (default is 3).}

\item{scen_warming}{Numeric. Warming increment (°C) used in the
simple-shift phenology model.}

\item{shift_per_deg}{Numeric. Linear shift in DOY per °C warming.}

\item{cmip6_tas}{Optional named list of daily temperature vectors (per country).
Required when using \code{phenology_method = "gdd_cmip6"}.}

\item{gdd_base}{Numeric. Base temperature for GDD accumulation.}

\item{gdd_threshold1, gdd_threshold2}{Numeric. GDD values defining the
onset and end of the phenological window in the GDD method.}

\item{color_ctrl}{Color for CTRL curves and shading.}

\item{color_scen}{Color for SCEN curves and shading.}

\item{title}{Optional custom plot title. Auto-generated titles are used
in facet or overlay modes.}
}
\value{
A \code{ggplot} object visualizing hail frequency curves together
with phenology windows. The structure of the plot (single panel,
facets, or overlay panels) is determined by the combination of arguments
\code{scen}, \code{facet_countries}, and \code{overlay_both}.
}
\description{
This function visualizes the temporal overlap between daily hail probability
and the phenological window (between two BBCH phenophases) for a selected
country or for all available countries. Phenological day-of-year (DOY)
values for CTRL and SCEN scenarios are computed internally using
\code{get_phenology_doys()}, ensuring full consistency with
\code{integral_hail()}.
}
\details{
The function supports multiple visualization modes:
\itemize{
\item Plot a single scenario (\code{"ctrl"} or \code{"scen"}) for one country.
\item Plot both scenarios (\code{"both"}) for one country in two facets.
\item Facet over multiple countries for a single scenario.
\item Facet over countries and scenarios in a \code{Country × Scenario} grid.
\item \strong{NEW:} Overlay CTRL and SCEN curves for all countries
(\code{overlay_both = TRUE}), producing one panel per country
with both scenarios overlaid—including their phenological windows.
}
}
\examples{
\dontrun{
data(hail)
pep <- pep_download()
data(giss)

# --- Single country -------------------------------------------------------

# CTRL only
plot_hail_overlap(hail, pep, giss, Country = "Austria", scen = "ctrl")

# SCEN only
plot_hail_overlap(hail, pep, giss, Country = "Austria", scen = "scen")

# CTRL + SCEN in separate facets for one country
plot_hail_overlap(hail, pep, giss, Country = "Austria", scen = "both")


# --- Faceting by country --------------------------------------------------

# All countries, CTRL only
plot_hail_overlap(hail, pep, giss, Country = "Austria",
                  scen = "ctrl", facet_countries = TRUE)

# All countries, SCEN only
plot_hail_overlap(hail, pep, giss, Country = "Austria",
                  scen = "scen", facet_countries = TRUE)


# --- Both scenarios for all countries ------------------------------------

# Country x Scenario facet grid (default)
plot_hail_overlap(hail, pep, Country = "Austria",
                  scen = "both", facet_countries = TRUE)

# Overlay CTRL + SCEN inside each country panel
plot_hail_overlap(hail, pep, giss, Country = "Austria",
                  scen = "both", facet_countries = TRUE,
                  overlay_both = TRUE)
}

}
\author{
Matthias Templ
}
